# app/config/entity_rec_config.py
# -*- coding: utf-8 -*-

import re

"""
实体识别配置（招投标公司版）：
- 仅删除字面量 \\n（两个字符：反斜杠 + n）
- 联系方式、身份证：正则全局扫描
- 人名：HanLP PERSON + KV提示词正则兜底
- 公司：仅保留“企业/公司型名称”（强公司后缀或以“公司”结尾），排除政府部门/事业单位/泛称机构
"""

# ========= 只处理字面量 \n（两个字符）=========
ESC_TOKENS = ("\\n",)

# ========= 签章/盖章相关词（过滤误报）=========
SIGN_WORDS = (
    "盖章", "签章", "签字", "签名",
    "（盖章）", "(盖章)", "（签名）", "(签名)", "（签字）", "(签字)",
    "印章", "公章", "法人章", "盖印"
)

# ========= 公司强后缀（命中即认为是公司）=========
COMPANY_SUFFIX_STRONG = (
    "有限责任公司",
    "股份有限公司",
    "有限公司",
    "集团有限公司",
    "集团公司",
)

# ========= 泛称机构/部门（直接剔除）=========
GENERIC_ORG_EXACT = {
    "中心", "信息中心", "技术中心", "服务中心", "采购中心", "维保中心", "指挥中心",
    "办公室", "项目部", "工程部", "采购部", "招标办", "采购办",
}
GENERIC_ORG_PATTERN = re.compile(
    r"^(?:中心|信息中心|技术中心|服务中心|采购中心|维保中心|指挥中心|办公室|项目部|工程部|采购部|招标办|采购办)$"
)

# ========= 政府部门/事业单位后缀：用于排除出“公司”实体（以这些词结尾就认为不是投标公司）=========
GOV_DEPT_SUFFIXES = (
    "人民政府", "政府",
    "管理局", "监督局", "监管局", "执法局",
    "税务局", "财政局", "公安局", "住建局", "发改局", "人社局", "教育局", "卫健局", "市场监督管理局",
    "委员会", "领导小组", "办公室", "办事处",
    "分局", "支队", "大队", "派出所",
    "法院", "检察院",
    "学校", "大学", "学院", "中学", "小学",
    "医院", "卫生院",
    "研究院",  # 如果你们要把“研究院”当公司（且不带有限公司），可移除这一项
    "中心", "信息中心", "技术中心", "服务中心", "采购中心", "维保中心", "指挥中心",
)
RE_GOV_DEPT = re.compile(rf"(?:{'|'.join(map(re.escape, GOV_DEPT_SUFFIXES))})$")

# ========= 人名提示词KV兜底正则（提示词 + 冒号后取值，剔除（签名）+ 吞下划线）=========
INVALID_NAME_PHRASE_RE = (
    r"(?:已接收|已收到|已签收|已签|收悉|确认|同意|盖章|签章|签名|签字|日期|电话|身份证|地址|单位|公司)"
)

NAME_LABELS = (
    "联系人|法定代表人或其授权代表|其授权代表|法定代表人姓名|法定代表人或单位负责人|单位负责人|"
    "法定代表人|法人|授权代表人|授权代表|授权委托人|代理人|项目负责人|负责人|经办人|代表人"
)

_RE_NAME_KV_STR = (
    rf"(?<![\u4e00-\u9fffA-Za-z0-9])(?:{NAME_LABELS})"
    r"(?:[；;（）()\s]*)"
    r"(?:[（(]\s*(?:签名|盖章|签字)\s*[）)])?"
    r"(?:[；;（）()\s]*)"
    r"[：:]"
    r"(?:[_＿—\-﹍﹎﹏\s]*)"
    rf"(?![\u4e00-\u9fff]{{0,10}}{INVALID_NAME_PHRASE_RE})"
    r"(?P<value>[\u4e00-\u9fff]{2,10}(?:·[\u4e00-\u9fff]{1,10})?)"
)
RE_NAME_KV = re.compile(_RE_NAME_KV_STR)

# ========= 公司兜底正则：强公司后缀（用于从文本直接抓公司）=========
_RE_COMPANY_STRONG_STR = (
    r"[\u4e00-\u9fffA-Za-z0-9·&（）()\-\.\s]{4,80}"
    r"(?:有限责任公司|股份有限公司|有限公司|集团有限公司|集团公司)"
)
RE_COMPANY_STRONG = re.compile(_RE_COMPANY_STRONG_STR)

# ========= 正则：联系方式（保留座机原格式；仅在 service 输出时去空白）=========
RE_MOBILE = r"(?<!\d)(?:\+?86[\s\-]?)?1[3-9]\d{9}(?!\d)"
RE_LANDLINE = r"(?<!\d)0\d{2,3}[\s\-]?\d{7,8}(?:[\s\-]?(?:转|ext\.?|x)\s*\d{1,6})?(?!\d)"
RE_400_800 = r"(?<!\d)(?:400|800)[\s\-]?\d{3}[\s\-]?\d{4}(?!\d)"
RE_PHONE = re.compile(rf"(?:{RE_MOBILE}|{RE_LANDLINE}|{RE_400_800})", re.IGNORECASE)

# ========= 正则：身份证（18/15）=========
RE_ID18 = (
    r"(?<!\d)[1-9]\d{5}"
    r"(?:19|20)\d{2}"
    r"(?:0[1-9]|1[0-2])"
    r"(?:0[1-9]|[12]\d|3[01])"
    r"\d{3}[\dXx](?!\d)"
)
RE_ID15 = (
    r"(?<!\d)[1-9]\d{5}"
    r"\d{2}"
    r"(?:0[1-9]|1[0-2])"
    r"(?:0[1-9]|[12]\d|3[01])"
    r"\d{3}(?!\d)"
)
RE_IDCARD = re.compile(rf"(?:{RE_ID18}|{RE_ID15})")

DEFAULT_ENTITIES = ["公司", "人名", "联系方式", "身份证"]
